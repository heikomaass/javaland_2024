version: '3'

services:
  performance-objectmapper:
    build: ../
    environment:
      JAVA_OPTIONS: -Xmx512M
    ports:
      - '8080:8080'
    healthcheck:
      test:  "wget --no-verbose --tries=1 --spider http://localhost:8080/actuator/health || exit 1"
      retries: 10
      timeout: 2s
      interval: 5s
      start_interval: 2s
  apache-bench-warmup:
    image: jordi/ab
    depends_on:
      performance-objectmapper:
        condition: service_healthy
    command:
      - -k
      - '-c 2'
      - '-n 10'
      - 'http://performance-objectmapper:8080/angebote'
  apache-bench-full:
    image: jordi/ab
    depends_on:
      apache-bench-warmup:
        condition: service_completed_successfully
    command:
      - -k
      - '-c 4'
      - '-n 100'
      - 'http://performance-objectmapper:8080/angebote'
